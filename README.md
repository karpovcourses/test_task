# Тестовое задание по бэкенду в karpov.courses

## Задача
Необходимо создать асинхронный API для сервиса запуска аналитических экспериментов.
Данные из csv файлов должны храниться в базе данных и подгружаться по необходимости.

## Требования
* Язык программирования Python, любой фреймворк;
* Любая SQL база данных (предпочтительнее Postgres);
* Использование очереди задач (Celery);
* Простая инструкция для локального запуска.

Если есть сомнения — принять решение самостоятельно, но в своём README.md рекомендуем выписать вопросы, принятые по ним решения и обоснование, почему сделали именно так.

## Детали
1. Ручка ```logs```. Должна выводить 100 последних записей из заданной таблицы. В запросе передаются следующие параметры:

| Параметр         | Описание                                                             |
|------------------|----------------------------------------------------------------------|
| ```table_name``` | название таблицы, из которой необходимо выводить записи              |
| ```from_date```  | при наличии необходимо выводить записи, начиная с этой даты          |
| ```user_id```    | при наличии необходимо выводить записи только от этого пользователя  |

В ```data/df_sales.csv``` лежит таблица с информацией о покупках, одна строка — один заказ. Атрибуты:

| Атрибут           | Описание                     |
|-------------------|------------------------------|
| ```sale_id```     | идентификатор покупки        |
| ```date```        | дата покупки                 |
| ```count_pizza``` | количество пицц в заказе     |
| ```count_drink``` | количество напитков в заказе |
| ```price```       | стоимость заказа             |
| ```user_id```     | идентификатор пользователя   |

В ```data/df_sales_detail.csv``` лежит таблица с детализированной информацией о покупках, одна строка — один товар в заказе. Атрибуты:

| Атрибут       | Описание                   |
|---------------|----------------------------|
| ```sale_id``` | идентификатор покупки      |
| ```good```    | название товара            |
| ```price```   | цена товара                |
| ```date```    | дата покупки               |
| ```user_id``` | идентификатор пользователя |

2. Ручка ```launch```. Запускает функцию ```calculate_metric``` в очереди задач и возвращает id задачи, по которой можно получить результат с помощью ручки ```get_result```.

```python
def calculate_metric():
    """Долгое вычисление метрики"""
    import random
    result = 0
    for i in range(10**7):
        if random.randint(0, 1):
            result += i * i
    return result
```

3. Ручка ```get_result```. Возвращает статус задачи и результат вычисления метрики по job id.

| Параметр         | Описание             |
|------------------|----------------------|
| ```job_id```     | идентификатор задачи |

## Усложнения
Не обязательно, но задание может быть выполнено с любым числом усложнений:
* Простой фронтенд (pure JS или любой фреймворк) для запуска API-ручек и отображения результата;
* Юнит тесты;
* Кэширование;
* Контейнеризация: есть возможность поднять проект с помощью ```docker-compose up```;
* Документация: есть структурированное описание методов сервиса (в коде или, например, swagger);
* Архитектура сервиса описана в виде текста и/или диаграмм, обоснован выбор технологий и тонкости реализации.